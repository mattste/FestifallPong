<!DOCTYPE html>
<htmL> 
<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script> 
  <script src="//js.leapmotion.com/0.2.0-beta1/leap.min.js"></script>


</head>
<body>
  <canvas id="canvas" width="1100" height="500"></canvas> 

<script>
var controllerOptions = { enableGestures: true },
    width = 960,
    height = 500,
    // canvas = d3.select('div#container')
    //     .append('canvas')
    //     .attr('width', width)
    //     .attr('height', height).node(),
    ctx = canvas.getContext('2d'),
    before = {},
    after = {},
    // color = d3.scale.category20();




  /* LIBRARY CODE */
  var canvas;  
  var ctx;
  var x = 400;
  var y = 300;
  var dx = 2;
  var dy = 4;
  var WIDTH = 1100;
  var HEIGHT = 500; 
  var intervalID;

  function circle(x,y,r) {
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI*2, true);
    ctx.fill();
  }

  function rect(x,y,w,h) {
    ctx.beginPath();
    ctx.rect(x,y,w,h);
    ctx.closePath();
    ctx.fill();
  }

  function clear() {
    ctx.clearRect(0, 0, WIDTH, HEIGHT);
  }

  function init() {
    canvas = document.getElementById("canvas");
    ctx = canvas.getContext("2d");
    return setInterval(draw, 10);
  }

  /**************END LIBRARY CODE */

  /******** PADDLES  ****/
  var LeftPaddleY;
  var LeftPaddleW;
  var LeftPaddleH;
  var LeftPaddleDY = 1;

  var RightPaddleY;
  var RightPaddleW;
  var RightPaddleH;
  var RightPaddleDY = 1;

  function init_paddles() {
    LeftPaddleY = HEIGHT/2;
    LeftPaddleH = 100;
    LeftPaddleW = 15;

    RightPaddleY = HEIGHT/2;
    RightPaddleH = 100;
    RightPaddleW = 15;
  }

  function draw_paddles(){
      //left paddle
    ctx.fillStyle ="#ff4444";
    rect(0, LeftPaddleY, LeftPaddleW, LeftPaddleH);
      //right paddle
    ctx.fillStyle="#3b5998";
    rect((WIDTH - RightPaddleW) , RightPaddleY, RightPaddleW, RightPaddleH);
  }

  /******** END PADDLES ****** /

  /** KEY EVENTS   **/ 
  var LeftUpKey = false;
  var LeftDownKey = false;
  var RightUpKey = false;
  var RightDownKey = false;

  var leftUpKeyValue = 81;
  var leftDownKeyValue = 65;
  var rightUpKeyValue = 80;
  var rightDownKeyValue = 76;

  function onKeyDown(evt) {
    if(evt.keyCode == leftUpKeyValue) {
      LeftUpKey = true;
      LeftPaddleDY = -4;
    }
    if(evt.keyCode == leftDownKeyValue) {
      LeftDownKey = true;
      LeftPaddleDY = 4;
    }
    if(evt.keyCode == rightUpKeyValue) {
      RightUpKey = true;
      RightPaddleDY = -4
    }
    if(evt.keyCode == rightDownKeyValue) {
      RightDownKey = true;
      RightPaddleDY = 4;
    }
  }

  function onKeyUp(evt) {
    if(evt.keyCode == leftUpKeyValue) {
      LeftUpKey = false;
      LeftPaddleDY = 1;
    }
    if(evt.keyCode == leftDownKeyValue) {
      LeftDownKey = false;
      LeftPaddleDY = 1;
    }
    if(evt.keyCode == rightUpKeyValue) {
      RightUpKey = false;
      RightPaddleDY = 1;
    }
    if(evt.keyCode == rightDownKeyValue) {
      RightDownKey = false;
      RightPaddleDY = 1;
    }
  }

  $(document).keydown(onKeyDown);
  $(document).keyup(onKeyUp);

  // *** END KEY EVENTS ****  
  // **MOVEMENT **

  function movePaddles(){
    if(LeftUpKey) {
      if(LeftPaddleY > 0){
        LeftPaddleY -= 7;
      }
    }
    if(LeftDownKey) {
      if(LeftPaddleY +LeftPaddleH < HEIGHT){
          LeftPaddleY += 7;
        }
    }

    if(RightUpKey) {
      if(RightPaddleY > 0){
        RightPaddleY -= 7;
      }
    }
    if(RightDownKey) {
      if(RightPaddleY+RightPaddleH < HEIGHT){
        RightPaddleY += 7;
      }
    }

  }


  // END MOVEMENT 

  // GAME FUNCTIONS //
  var leftScore = 0;
  var rightScore = 0;



  function drawScoreboard(x, y){
    ctx.font = "20px Arial";
    ctx.fillStyle ="#ff4444";
    ctx.fillText("Red: "+leftScore, WIDTH/3, 20);
    ctx.fillStyle="#3b5998";
    ctx.fillText("Blue: "+rightScore, WIDTH/3 *2, 20);
  }

  function endGame(){
    rect(0,0, WIDTH, HEIGHT);
    ctx.fillStyle = "#000000";
    ctx.font = "50px Arial";
    ctx.fillText("GAME OVER", WIDTH/2 - 100, HEIGHT/2 - 5);

  }

  function draw() {
    clear();
    ctx.fillStyle = "#FAF7F8";
    rect(0,0, WIDTH, HEIGHT);
    drawScoreboard(leftScore,rightScore);
    movePaddles();
    draw_paddles();
    ctx.fillStyle = "#444444";
    circle(x, y, 10);

    if (x + dx > (WIDTH-LeftPaddleW) || x + dx < LeftPaddleW){
      if( ( y < LeftPaddleY+LeftPaddleH && y > LeftPaddleY) && x < WIDTH/2){
        dx = -(1.3)*dx;
        dy = (1.3)*LeftPaddleDY;
      } 
      else if( ( y < RightPaddleY + RightPaddleH) && (y > RightPaddleY) && x > WIDTH/2 ){
        dx = -(1.3)*dx;
        dy = (1.3)*RightPaddleDY;
      }
      else {
      setTimeout(function(){
        if(x > WIDTH-RightPaddleW){
          leftScore += 1;
          checkEnd();
        }
        if(x < RightPaddleW){
          rightScore += 1;
          checkEnd();
        }
        x = 20;
        y = 20;
        dx = 2;
        dy = 4;
      }, 200);
      //endGame();
      //clearInterval(intervalID);
    }

    }
    if (y + dy > HEIGHT || y + dy < 0)
      dy = -dy;

    x += dx;
    y += dy;
  }


  // *** END MOVEMENT    ***

  var intervalID = init();
  init_paddles();



  Leap.loop(controllerOptions, function(frame, done) {
    after = {};
    for (var i = 0; i < frame.pointables.length; i++) {
        after[frame.pointables[i].id] = frame.pointables[i];
    }
    draw();
    done();
});













</script>
</body>
</htmL>

